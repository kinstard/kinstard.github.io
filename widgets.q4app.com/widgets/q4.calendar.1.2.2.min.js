/*
Widget:   q4.calendar
Version:  1.2.2
Compiled: 2017-05-23
*/
!function(a){a.widget("q4.calendar",{options:{popupCls:".module-event-calendar_event-container",dateFormat:"MMM, DD YYYY",publicFeed:!1,languageId:GetLanguageId(),url:"",apiKey:"",eventSelection:3,news:!0,presentations:!0,financials:!0,slideshare:"",triggerEventsLoad:!0,defaultTag:"",eventTemplates:{location:'{{#location}}<div class="module_location"><span class="module_location-text">{{location}}</span></div>{{/location}}',speakers:'{{#speakers.length}}<div class="module_speakers"><h4>Speaker(s):</h4><ul>{{#speakers}}<li class="module_speaker"><i class="q4-icon_user-fill"></i> {{name}}, {{position}}</li> {{/speakers}}</ul></div>{{/speakers.length}}',webcast:'{{#webcast}}<div class="module_webcast"><a href="{{webcast}}" target="_blank" class="module_link module_webcast-link"><i class="q4-icon_webcast"></i> Webcast <span class="sr-only">(opens in new window)</span></a></div>{{/webcast}}',news:'{{#news}}<div class="module_news"><a href="{{url}}" target="_blank" class="module_link module_news-link"><i class="q4-icon_html"></i> Press Release <span class="sr-only">(opens in new window)</span></a></div>{{/news}}',docs:'{{#docs.length}}<ul class="module_attachments">{{#docs}}<li class="module_attachment {{Type}}"><a href="{{Url}}" target="_blank" class="module_link module_attachment-link"><i class="q4-icon_pdf"></i> {{Title}} <span class="sr-only">(opens in new window)</span></a></li>{{/docs}}</ul>{{/docs.length}}',presentations:'{{#presentations}}<div class="module_presentation"><a href="{{DocumentPath}}" target="_blank" class="module_link module_presentation-link"><i class="q4-icon_pdf"></i> View this Presentation <span class="sr-only">(opens in new window)</span></a></div>{{/presentations}}',financials:'{{#financials}}<div class="module_financials">{{#Documents}}<li><a href="{{DocumentUrl}}" target="_blank" class="module_link module_financial-link"><i class="q4-icon_pdf"></i> {{DocumentTitle}} <span class="sr-only">(opens in new window)</span></a></li>{{/Documents}}</div>{{/financials}}',addToCal:'<div class="module_add-to-calendar"><span class="module_link module_add-to-calendar-reveal"><i class="q4-icon_calendar"></i> Add to Calendar</span><ul class="module_add-to-calendar-list"><li class="module_add-to-calendar-item module_add-to-calendar-item--apple"><a href="/preview/DownloadICal.aspx?id={{id}}" target="_blank" class="module_add-to-calendar-link"><i class="q4-icon_apple"></i><span class="module_add-to-calendar-text sr-only">Add to Apple Calendar</span></a></li><li class="module_add-to-calendar-item module_add-to-calendar-item--google"><a href="/preview/DownloadICal.aspx?id={{id}}&amp;platform=GoogleCalendar" target="_blank" class="module_add-to-calendar-link"><i class="q4-icon_google"></i><span class="module_add-to-calendar-text sr-only">Add to Google Calendar</span></a></li><li class="module_add-to-calendar-item module_add-to-calendar-item--outlook"><a href="/preview/DownloadICal.aspx?id={{id}}" target="_blank" class="module_add-to-calendar-link"><i class="q4-icon_microsoft"></i><span class="module_add-to-calendar-text sr-only">Add to Microsoft Outlook</span></a></li><li class="module_add-to-calendar-item module_add-to-calendar-item--ics"><a href="/preview/DownloadICal.aspx?id={{id}}" target="_blank" class="module_add-to-calendar-link"><i class="q4-icon_calendar"></i><span class="module_add-to-calendar-text sr-only">Add to iCalendar</span></a></li></ul></div>',event:function(){return'{{#items}}<div class="module_item" data-cls="{{clndrDateCls}}"><div class="module_date-time"><span class="module_date-text">{{{date}}}</span></div><div class="module_headline"><a href="{{url}}" class="module_headline-link">{{title}}</a></div><div class="module_links">'+this.webcast+this.addToCal+"</div></div>{{/items}}"}},onEventsLoad:function(b,c,d){var e=[];d.defaultTag.length&&a.each(c,function(b,c){if(a.inArray(d.defaultTag,c.tag.split(" "))>-1)return void e.push(c.items)}),e.length||a.each(c.reverse(),function(a,b){var c=new Date((new Date).setHours(23,59,59,59));if(new Date(new Date(b.endDate).setHours(23,59,59,59))>c)return void e.push(b.items)}),a(d.popupCls).html(Mustache.render(d.eventTemplates.event(),{items:[{date:moment(e[0].StartDate).format(d.dateFormat),timeZone:"0"==e[0].TimeZone?"":e[0].TimeZone,docs:e[0].Attachments,id:new Date(e[0].StartDate)>new Date&&e[0].EventId,location:e[0].Location,news:e[0].EventPressRelease,presentations:e[0].EventPresentation,speakers:e[0].EventSpeaker,title:e[0].Title,url:e[0].LinkToDetailPage,webcast:e[0].WebCastLink,financials:e[0].EventFinancialReport,tags:e[0].TagsList,clndrDateCls:"calendar-day-"+a.datepicker.formatDate("yy-mm-dd",new Date(e[0].StartDate))}]}));var f=a(".module-event-calendar_event-container .module_item");f.length&&a(".module-event-calendar_day").filter("."+f.data("cls")).addClass("module-event-calendar_day--selected"),void 0!==q4App&&void 0!==q4App.addToCalendar&&void 0!==q4App.hidePastCal&&(q4App.addToCalendar(d.popupCls+" .module_add-to-calendar"),q4App.hidePastCal(a(d.popupCls)))},onSlideShareLoad:function(a,b){},eventSize:25,tags:[],calendar:{multiDayEvents:{startDate:"startDate",endDate:"endDate"},render:function(a){return Mustache.render('<div class="module-event-calendar_controls"><div class="module-event-calendar_previous-month clndr-previous-button"><i class="q4-icon_chevron-left"></i></div><div class="module-event-calendar_month">{{month}} {{year}}</div><div class="module-event-calendar_next-month clndr-next-button"><i class="q4-icon_chevron-right"></i></div></div><div class="module-event-calendar_day-container grid--no-gutter">{{#daysOfTheWeek}}<div class="module-event-calendar_day module-event-calendar_day--name grid_col">{{.}}</div>{{/daysOfTheWeek}}{{#days}}<div class="{{classes}} grid_col">{{day}}</div>{{/days}}</div>',a)},template:null,weekOffset:0,daysOfTheWeek:["SUN","MON","TUE","WED","THUR","FRI","SAT"],targets:{day:"module-event-calendar_day",empty:"module-event-calendar_day--empty",nextButton:"module-event-calendar_next-month",todayButton:"module-event-calendar_today",previousButton:"module-event-calendar_previous-month",nextYearButton:"module-event-calendar_next-year",previousYearButton:"module-event-calendar_previous-year"},classes:{past:"module-event-calendar_day--past",today:"module-event-calendar_day--today",event:"module-event-calendar_day--event",selected:"module-event-calendar_day--selected",inactive:"module-event-calendar_day--inactive",lastMonth:"module-event-calendar_day--last-month",nextMonth:"module-event-calendar_day--next-month",adjacentMonth:"module-event-calendar_day--adjacent-month"},showAdjacentMonths:!0,adjacentDaysChangeMonth:!1,ready:function(){a(".module-event-calendar_calendar-container").on("click",".module-event-calendar_day--event",function(){a(".module-event-calendar_calendar-container").find(".module-event-calendar_day--event").removeClass("module-event-calendar_day--selected"),a(this).addClass("module-event-calendar_day--selected")})},doneRendering:function(){},clickEvents:{click:function(b){var c={date:null,items:[]},d=a.q4.calendar._proto.options,e=b.element.className.split(" ");b.events.length&&(a.each(b.events,function(a,b){var f=b.items;c.items.push({date:moment(f.StartDate).format(d.dateFormat),timeZone:"0"==f.TimeZone?"":f.TimeZone,docs:f.Attachments,id:new Date(f.StartDate)>new Date&&f.EventId,location:f.Location,news:f.EventPressRelease,presentations:f.EventPresentation,speakers:f.EventSpeaker,title:f.Title,url:f.LinkToDetailPage,webcast:f.WebCastLink,financials:f.EventFinancialReport,tags:f.TagsList,clndrDateCls:e[e.length-3]})}),a(d.popupCls).html(Mustache.render(d.eventTemplates.event(),c)),void 0!==q4App&&void 0!==q4App.addToCalendar&&void 0!==q4App.hidePastCal&&(q4App.addToCalendar(d.popupCls+" .module_add-to-calendar"),q4App.hidePastCal(a(d.popupCls))))},nextMonth:function(a){},previousMonth:function(a){},nextYear:function(a){},previousYear:function(a){},onMonthChange:function(b){var c=a(".module-event-calendar_event-container .module_item");c.length&&a(".module-event-calendar_day").filter("."+c.data("cls")).addClass("module-event-calendar_day--selected")},onYearChange:function(a){},today:function(a){}}}},_init:function(){this.callClndr(),a.extend(a.q4.calendar._proto.options,this.options)},publicEventParams:function(){var a=this.options;return{apiKey:a.apiKey,pageSize:a.eventSize,includeTags:!0,eventSelection:a.eventSelection,test:null,sortOperator:1,EventDateFilter:3,includePressReleases:a.news,includePresentations:a.presentations,includeFinancialReports:a.financials,tagList:a.tags.join("|")}},privateEventParams:function(){var a=this.options;return{serviceDto:{ViewType:GetViewType(),ViewDate:GetViewDate(),Signature:GetSignature(),LanguageId:a.languageId,RevisionNumber:GetRevisionNumber(),TagList:a.tags,StartIndex:0,ItemCount:a.eventSize,IncludeTags:!0},year:-1,eventSelection:a.eventSelection,sortOperator:1,includePressReleases:a.news,includePresentations:a.presentations,includeFinancialReports:a.financials}},getPrivateEventList:function(){var b=this;url=location.href.toLowerCase(),a.ajax({type:"POST",url:"/services/EventService.svc/GetEventList",data:JSON.stringify(b.privateEventParams()),contentType:"application/json; charset=utf-8",dataType:"json",success:function(a){b.buildEventObj(a.GetEventListResult)},error:function(){console.log("Events failed to load")}})},getPublicEventList:function(){var b=this;a.ajax({type:"GET",url:b.options.url+"/feed/Event.svc/GetEventList",data:b.publicEventParams(),dataType:"jsonp",success:function(a){b.buildEventObj(a.GetEventListResult)},error:function(){console.log("Events failed to load")}})},buildEventObj:function(b){var c=this,d=[];a.each(b,function(a,b){var c=moment(b.StartDate).format("YYYY-MM-DD"),e=moment(b.EndDate).format("YYYY-MM-DD"),f={startDate:c,endDate:e,tag:b.TagsList.join(" "),items:b};d.push(f)}),c.calendar.addEvents(d),void 0!==this.options.onEventsLoad&&"function"==typeof this.options.onEventsLoad&&c.options.triggerEventsLoad&&this.options.onEventsLoad(c.calendar,d,c.options)},getSlideShare:function(){var b=this;a.getJSON("//widgets.q4web.com/slideshare/rss/getRssByUser/"+b.options.slideshare+"?callback=?",function(a){b.parseSlideShare(a)})},parseSlideShare:function(b){var c=this,d=[];a.each(b,function(a,b){var c=moment(b.published).format("YYYY-MM-DD"),e={startDate:c,endDate:c,slideshare:!0,items:b};d.push(e)}),c.calendar.addEvents(d),void 0!==this.options.onSlideShareLoad&&"function"==typeof this.options.onSlideShareLoad&&this.options.onSlideShareLoad(c.calendar,d)},callClndr:function(){var a=this;a.calendar=a.element.clndr(a.options.calendar),a.options.publicFeed?a.getPublicEventList():a.getPrivateEventList(),a.options.slideshare.length&&a.getSlideShare()},destroy:function(){this.element.html("")},_setOption:function(a,b){this._superApply(arguments)}})}(jQuery);